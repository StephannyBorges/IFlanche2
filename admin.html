<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFLANCHE - √Årea Administrativa</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="page-dashboard admin-mode">

    <header class="main-header admin-header">
        <div class="logo">
            <a href="login.html">IFLANCHE <span style="font-size: 0.6em; opacity: 0.8;">ADMIN</span></a>
        </div>
        
        <nav class="nav-items">
            <div class="user-badge">
                Ol√°, <span id="nomeServidor">Servidor</span>
            </div>
            <a href="login.html" class="btn-logout" onclick="localStorage.removeItem('iflanche_cargo')">Sair</a>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-wrapper">
            <section class="content-area full-width">
                <div class="section-header flex-header">
                    <div>
                        <h1>Gerenciar Card√°pio</h1>
                        <p>Adicione ou edite as refei√ß√µes da semana.</p>
                    </div>
                    <button class="btn-add" onclick="abrirModal()">+ Nova Refei√ß√£o</button>
                </div>

                <div class="table-responsive">
                    <table class="meal-table admin-table">
                        <thead>
                            <tr>
                                <th>Dia</th>
                                <th>Lanche Manh√£</th>
                                <th>Almo√ßo</th>
                                <th>Lanche Tarde</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCorpo">
                            </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <div id="modalEdicao" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="fecharModal()">&times;</span>
            <h2 id="tituloModal">Nova Refei√ß√£o</h2>
            
            <form id="formRefeicao" onsubmit="salvarRefeicao(event)">
                <input type="hidden" id="idRefeicao"> <div class="input-group">
                    <label>Dia da Semana</label>
                    <select id="diaSemana" class="input-select" required>
                        <option value="Segunda-feira">Segunda-feira</option>
                        <option value="Ter√ßa-feira">Ter√ßa-feira</option>
                        <option value="Quarta-feira">Quarta-feira</option>
                        <option value="Quinta-feira">Quinta-feira</option>
                        <option value="Sexta-feira">Sexta-feira</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Lanche Manh√£</label>
                    <input type="text" id="lancheManha" placeholder="Ex: Fruta + Iogurte" required>
                </div>

                <div class="input-group">
                    <label>Almo√ßo</label>
                    <input type="text" id="almoco" placeholder="Ex: Feijoada" required>
                </div>

                <div class="input-group">
                    <label>Lanche Tarde</label>
                    <input type="text" id="lancheTarde" placeholder="Ex: Bolo" required>
                </div>

                <button type="submit" class="btn-login" style="margin-top: 10px;">Salvar Dados</button>
            </form>
        </div>
    </div>

    <script>
        // --- DADOS PADR√ÉO (Para iniciar o sistema na primeira vez) ---
        const dadosIniciais = [
            { id: 1, dia: 'Segunda-feira', manha: 'Fruta + Iogurte', almoco: 'Feijoada Completa', tarde: 'Bolo de Cenoura' },
            { id: 2, dia: 'Ter√ßa-feira', manha: 'P√£o com Queijo', almoco: 'Frango Assado', tarde: 'Salada de Frutas' }
        ];

        // --- FUN√á√ïES PRINCIPAIS ---

        // 1. Carregar dados ao abrir a p√°gina
        window.onload = function() {
            // Nome do Servidor
            const cargo = localStorage.getItem('iflanche_cargo');
            if(cargo) document.getElementById('nomeServidor').innerText = cargo;

            renderizarTabela();
        }

        // 2. Fun√ß√£o que desenha a tabela na tela
        function renderizarTabela() {
            // Pega do LocalStorage OU usa os dados iniciais
            let cardapio = JSON.parse(localStorage.getItem('iflanche_cardapio'));
            
            if (!cardapio || cardapio.length === 0) {
                cardapio = dadosIniciais;
                localStorage.setItem('iflanche_cardapio', JSON.stringify(cardapio));
            }

            const tbody = document.getElementById('tabelaCorpo');
            tbody.innerHTML = ''; // Limpa antes de desenhar

            cardapio.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="day">${item.dia}</td>
                    <td>${item.manha}</td>
                    <td>${item.almoco}</td>
                    <td>${item.tarde}</td>
                    <td class="actions-cell">
                        <button class="btn-action edit" onclick="abrirModal(${item.id})">‚úèÔ∏è</button>
                        <button class="btn-action delete" onclick="deletar(${item.id})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // 3. Abrir Modal (Funciona para Criar E Editar)
        function abrirModal(id = null) {
            const modal = document.getElementById('modalEdicao');
            const titulo = document.getElementById('tituloModal');
            
            // Limpa formul√°rio
            document.getElementById('formRefeicao').reset();

            if (id) {
                // MODO EDI√á√ÉO: Preenche os campos com os dados existentes
                titulo.innerText = "Editar Refei√ß√£o";
                const cardapio = JSON.parse(localStorage.getItem('iflanche_cardapio'));
                const item = cardapio.find(c => c.id === id);
                
                document.getElementById('idRefeicao').value = item.id;
                document.getElementById('diaSemana').value = item.dia;
                document.getElementById('lancheManha').value = item.manha;
                document.getElementById('almoco').value = item.almoco;
                document.getElementById('lancheTarde').value = item.tarde;
            } else {
                // MODO CRIA√á√ÉO
                titulo.innerText = "Nova Refei√ß√£o";
                document.getElementById('idRefeicao').value = '';
            }

            modal.style.display = "flex";
        }

        function fecharModal() {
            document.getElementById('modalEdicao').style.display = "none";
        }

        // 4. Salvar (Adicionar ou Editar)
        function salvarRefeicao(event) {
            event.preventDefault();

            const id = document.getElementById('idRefeicao').value;
            const dia = document.getElementById('diaSemana').value;
            const manha = document.getElementById('lancheManha').value;
            const almoco = document.getElementById('almoco').value;
            const tarde = document.getElementById('lancheTarde').value;

            let cardapio = JSON.parse(localStorage.getItem('iflanche_cardapio')) || [];

            if (id) {
                // Editar Existente
                const index = cardapio.findIndex(c => c.id == id);
                if (index !== -1) {
                    cardapio[index] = { id: parseInt(id), dia, manha, almoco, tarde };
                }
            } else {
                // Criar Novo (Gera um ID aleat√≥rio baseado no tempo)
                const novoId = Date.now(); 
                cardapio.push({ id: novoId, dia, manha, almoco, tarde });
            }

            localStorage.setItem('iflanche_cardapio', JSON.stringify(cardapio));
            fecharModal();
            renderizarTabela();
        }

        // 5. Deletar
        function deletar(id) {
            if (confirm("Tem certeza que deseja excluir esta refei√ß√£o?")) {
                let cardapio = JSON.parse(localStorage.getItem('iflanche_cardapio'));
                cardapio = cardapio.filter(item => item.id !== id);
                localStorage.setItem('iflanche_cardapio', JSON.stringify(cardapio));
                renderizarTabela();
            }
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalEdicao');
            if (event.target == modal) {
                fecharModal();
            }
        }
    </script>
</body>
</html>